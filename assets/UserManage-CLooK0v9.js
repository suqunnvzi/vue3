import{u as ie}from"./setting-CBvWOeVN.js";import{I as k,d as me,r as i,a as pe,D as ce,g as p,o as R,c as P,b as e,w as t,h as r,J as C,j as m,m as I,v as T,n as B,z as fe,F,s as ge,B as $,K as x,p as ve,k as _e,_ as ye}from"./index-r54z97pg.js";const be=(n,d,_)=>k.get(`/admin/acl/user/${n}/${d}/?username=${_}`),we=n=>n.id?k.put("/admin/acl/user/update",n):k.post("/admin/acl/user/save",n),Ve=n=>k.get("/admin/acl/user/toAssign/"+n),he=n=>k.post("/admin/acl/user/doAssignRole",n),Ce=n=>k.delete("/admin/acl/user/remove/"+n),ke=n=>k.delete("/admin/acl/user/batchRemove",{data:n}),Ue=n=>(ve("data-v-c05437ff"),n=n(),_e(),n),xe={style:{flex:"auto"}},ze=Ue(()=>I("h4",null,"分配角色(职位)",-1)),Se={style:{flex:"auto"}},Re=me({__name:"UserManage",setup(n){let d=i(1),_=i(5),j=i(0),z=i([]),f=i(!1),g=i(!1),U=i([]),y=i([]),s=pe({username:"",name:"",password:""}),q=i([]),b=i(),w=i(""),L=ie();ce(()=>{V()});const V=async(o=1)=>{d.value=o;let l=await be(d.value,_.value,w.value);l.code==200&&(j.value=l.data.total,z.value=l.data.records)},H=()=>{V()},J=()=>{f.value=!0,Object.assign(s,{id:0,username:"",name:"",password:""}),$(()=>{b.value.clearValidate("username"),b.value.clearValidate("name"),b.value.clearValidate("password")})},K=o=>{f.value=!0,Object.assign(s,o),$(()=>{b.value.clearValidate("username"),b.value.clearValidate("name")})},G=async()=>{await b.value.validate(),(await we(s)).code==200?(f.value=!1,x({type:"success",message:s.id?"更新成功":"添加成功"}),window.location.reload()):(f.value=!1,x({type:"error",message:s.id?"更新失败":"添加失败"}))},Q=()=>{f.value=!1},W={username:[{required:!0,trigger:"blur",validator:(o,l,u)=>{console.log(o),l.trim().length>=5?u():u(new Error("用户名字至少五位"))}}],name:[{required:!0,trigger:"blur",validator:(o,l,u)=>{console.log(o),l.trim().length>=5?u():u(new Error("用户昵称至少五位"))}}],password:[{required:!0,trigger:"blur",validator:(o,l,u)=>{console.log(o),l.trim().length>=6?u():u(new Error("用户密码至少六位"))}}]},X=async o=>{Object.assign(s,o);let l=await Ve(s.id);l.code==200&&(U.value=l.data.allRolesList,y.value=l.data.assignRoles,g.value=!0)},A=i(!1),N=i(!0),Y=o=>{y.value=o?U.value:[],N.value=!1},Z=o=>{A.value=o.length===U.value.length,N.value=o.length!==U.value.length},ee=async()=>{let o={userId:s.id,roleIdList:y.value.map(u=>u.id)};(await he(o)).code==200&&(x({type:"success",message:"分配职务成功"}),g.value=!1,V(d.value))},le=async o=>{(await Ce(o)).code==200&&(x({type:"success",message:"删除成功"}),V(z.value.length>1?d.value:d.value-1))},ae=o=>{q.value=o},te=async()=>{let o=q.value.map(u=>u.id);(await ke(o)).code==200&&(x({type:"success",message:"删除成功"}),V(z.value.length>1?d.value:d.value-1))},oe=()=>{V(),w.value=""},re=()=>{L.refresh=!L.refresh};return(o,l)=>{const u=p("el-input"),h=p("el-form-item"),c=p("el-button"),E=p("el-form"),D=p("el-card"),v=p("el-table-column"),se=p("el-popconfirm"),ne=p("el-table"),ue=p("el-pagination"),M=p("el-drawer"),O=p("el-checkbox"),de=p("el-checkbox-group");return R(),P(F,null,[e(D,{style:{height:"80px"}},{default:t(()=>[e(E,{inline:!0,class:"form"},{default:t(()=>[e(h,{label:"用户名:"},{default:t(()=>[e(u,{placeholder:"请你输入搜索用户名",modelValue:r(w),"onUpdate:modelValue":l[0]||(l[0]=a=>C(w)?w.value=a:w=a)},null,8,["modelValue"])]),_:1}),e(h,null,{default:t(()=>[e(c,{type:"primary",size:"default",disabled:!r(w),onClick:oe},{default:t(()=>[m("搜索")]),_:1},8,["disabled"]),e(c,{type:"primary",size:"default",onClick:re},{default:t(()=>[m("重置")]),_:1})]),_:1})]),_:1})]),_:1}),e(D,{style:{margin:"10px 0px"}},{default:t(()=>[e(c,{type:"primary",size:"default",onClick:J},{default:t(()=>[m("添加用户")]),_:1}),e(c,{type:"primary",size:"default",disabled:!r(q).length,onClick:te},{default:t(()=>[m("批量删除")]),_:1},8,["disabled"]),e(ne,{onSelectionChange:ae,style:{margin:"10px 0px"},border:"",data:r(z)},{default:t(()=>[e(v,{type:"selection",align:"center"}),e(v,{label:"#",align:"center",type:"index"}),e(v,{label:"ID",align:"center",prop:"id"}),e(v,{label:"用户名字",align:"center",prop:"username","show-overflow-tooltip":""}),e(v,{label:"用户名称",align:"center",prop:"name","show-overflow-tooltip":""}),e(v,{label:"用户角色",align:"center",prop:"roleName","show-overflow-tooltip":""}),e(v,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":""}),e(v,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":""}),e(v,{label:"操作",width:"300px",align:"center"},{default:t(({row:a})=>[e(c,{type:"primary",size:"small",icon:"User",onClick:S=>X(a)},{default:t(()=>[m("分配角色")]),_:2},1032,["onClick"]),e(c,{type:"primary",size:"small",icon:"Edit",onClick:S=>K(a)},{default:t(()=>[m("编辑")]),_:2},1032,["onClick"]),e(se,{title:`你确定要删除${a.username}?`,width:"260px",onConfirm:S=>le(a.id)},{reference:t(()=>[e(c,{type:"primary",size:"small",icon:"Delete"},{default:t(()=>[m("删除")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(ue,{"current-page":r(d),"onUpdate:currentPage":l[1]||(l[1]=a=>C(d)?d.value=a:d=a),"page-size":r(_),"onUpdate:pageSize":l[2]||(l[2]=a=>C(_)?_.value=a:_=a),"page-sizes":[5,7,9,11],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:r(j),onCurrentChange:V,onSizeChange:H},null,8,["current-page","page-size","total"])]),_:1}),e(M,{modelValue:r(f),"onUpdate:modelValue":l[6]||(l[6]=a=>C(f)?f.value=a:f=a)},{header:t(()=>[I("h4",null,T(r(s).id?"更新用户":"添加用户"),1)]),default:t(()=>[e(E,{model:r(s),rules:W,ref_key:"formRef",ref:b},{default:t(()=>[e(h,{label:"用户姓名",prop:"username"},{default:t(()=>[e(u,{placeholder:"请您输入用户姓名",modelValue:r(s).username,"onUpdate:modelValue":l[3]||(l[3]=a=>r(s).username=a)},null,8,["modelValue"])]),_:1}),e(h,{label:"用户昵称",prop:"name"},{default:t(()=>[e(u,{placeholder:"请您输入用户昵称",modelValue:r(s).name,"onUpdate:modelValue":l[4]||(l[4]=a=>r(s).name=a)},null,8,["modelValue"])]),_:1}),r(s).id?fe("",!0):(R(),B(h,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[e(u,{placeholder:"请您输入用户密码",modelValue:r(s).password,"onUpdate:modelValue":l[5]||(l[5]=a=>r(s).password=a)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),footer:t(()=>[I("div",xe,[e(c,{onClick:Q},{default:t(()=>[m("取消")]),_:1}),e(c,{type:"primary",onClick:G},{default:t(()=>[m("确定")]),_:1})])]),_:1},8,["modelValue"]),e(M,{modelValue:r(g),"onUpdate:modelValue":l[11]||(l[11]=a=>C(g)?g.value=a:g=a)},{header:t(()=>[ze]),default:t(()=>[e(E,null,{default:t(()=>[e(h,{label:"用户姓名"},{default:t(()=>[e(u,{modelValue:r(s).username,"onUpdate:modelValue":l[7]||(l[7]=a=>r(s).username=a),disabled:!0},null,8,["modelValue"])]),_:1}),e(h,{label:"职位列表"},{default:t(()=>[e(O,{onChange:Y,modelValue:A.value,"onUpdate:modelValue":l[8]||(l[8]=a=>A.value=a),indeterminate:N.value},{default:t(()=>[m("全选")]),_:1},8,["modelValue","indeterminate"]),e(de,{modelValue:r(y),"onUpdate:modelValue":l[9]||(l[9]=a=>C(y)?y.value=a:y=a),onChange:Z},{default:t(()=>[(R(!0),P(F,null,ge(r(U),(a,S)=>(R(),B(O,{key:S,label:a},{default:t(()=>[m(T(a.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),footer:t(()=>[I("div",Se,[e(c,{onClick:l[10]||(l[10]=a=>C(g)?g.value=!1:g=!1)},{default:t(()=>[m("取消")]),_:1}),e(c,{type:"primary",onClick:ee},{default:t(()=>[m("确定")]),_:1})])]),_:1},8,["modelValue"])],64)}}}),je=ye(Re,[["__scopeId","data-v-c05437ff"]]);export{je as default};
