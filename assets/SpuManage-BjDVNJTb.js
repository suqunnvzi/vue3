import{I as $,d as X,r as m,R as de,g as o,o as _,n as N,w as t,b as e,h as u,c as B,F as R,s as T,J as G,m as O,j as M,v as ie,K as L,a as pe,Q as ce,M as me,A as _e,G as ge,t as Q,x as W}from"./index-r54z97pg.js";const fe=(g,v,k)=>$.get(`/admin/product/${g}/${v}?category3Id=${k}`),Y=()=>$.get("/admin/product/baseTrademark/getTrademarkList"),ee=g=>$.get("/admin/product/spuImageList/"+g),le=g=>$.get("/admin/product/spuSaleAttrList/"+g),Z=()=>$.get("/admin/product/baseSaleAttrList"),Se=g=>g.id?$.post("/admin/product/updateSpuInfo",g):$.post("/admin/product/saveSpuInfo",g),ye=g=>$.post("/admin/product/saveSkuInfo",g),ve=g=>$.get("/admin/product/findBySpuId/"+g),be=g=>$.delete("/admin/product/deleteSpu/"+g),Ve=["src"],ke=X({__name:"SpuForm",emits:["changeScene"],setup(g,{expose:v,emit:k}){let I=k;const w=()=>{I("changeScene",0)};let z=m([]),b=m([]),s=m([]),K=m([]),P=m(!1),D=m(""),f=m({category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),A=m("");const U=async l=>{f.value=l;let a=await Y(),y=await ee(l.id),h=await le(l.id),F=await Z();z.value=a.data,b.value=y.data.map(d=>({name:d.imgName,url:d.imgUrl})),s.value=h.data,K.value=F.data},i=l=>{D.value=l.url,P.value=!0},r=()=>{console.log(123)},p=l=>l.type=="image/png"||l.type=="image/jpeg"||l.type=="image/gif"?l.size/1024/1024<3?!0:(L({type:"error",message:"上传文件务必小于3M"}),!1):(L({type:"error",message:"上传文件务必PNG|JPG|GIF"}),!1);let V=de(()=>K.value.filter(a=>s.value.every(y=>a.name!=y.saleAttrName)));const c=()=>{const[l,a]=A.value.split(":");let y={baseSaleAttrId:l,saleAttrName:a,spuSaleAttrValueList:[]};s.value.push(y),A.value=""},S=l=>{l.flag=!0,l.saleAttrValue=""},q=l=>{const{baseSaleAttrId:a,saleAttrValue:y}=l;let h={baseSaleAttrId:a,saleAttrValueName:y};if(y.trim()==""){L({type:"error",message:"属性值不能为空的"});return}if(l.spuSaleAttrValueList.find(d=>d.saleAttrValueName==y)){L({type:"error",message:"属性值重复"});return}l.spuSaleAttrValueList.push(h),l.flag=!1},x=async()=>{f.value.spuImageList=b.value.map(a=>({imgName:a.name,imgUrl:a.response&&a.response.data||a.url})),f.value.spuSaleAttrList=s.value,(await Se(f.value)).code==200?(L({type:"success",message:f.value.id?"更新成功":"添加成功"}),I("changeScene",0)):L({type:"error",message:f.value.id?"更新失败":"添加失败"})};return v({initHasSpuData:U,initAddSpu:async l=>{Object.assign(f.value,{category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),b.value=[],s.value=[],A.value="",f.value.category3Id=l;let a=await Y(),y=await Z();z.value=a.data,K.value=y.data}}),(l,a)=>{const y=o("el-input"),h=o("el-form-item"),F=o("el-option"),d=o("el-select"),j=o("Plus"),te=o("el-icon"),ae=o("el-upload"),ne=o("el-dialog"),E=o("el-button"),J=o("el-table-column"),ue=o("el-tag"),oe=o("el-table"),se=o("el-form");return _(),N(se,{"label-width":"100px"},{default:t(()=>[e(h,{label:"SPU名称"},{default:t(()=>[e(y,{placeholder:"请你输入SPU名称",modelValue:u(f).spuName,"onUpdate:modelValue":a[0]||(a[0]=n=>u(f).spuName=n)},null,8,["modelValue"])]),_:1}),e(h,{label:"SPU品牌"},{default:t(()=>[e(d,{modelValue:u(f).tmId,"onUpdate:modelValue":a[1]||(a[1]=n=>u(f).tmId=n)},{default:t(()=>[(_(!0),B(R,null,T(u(z),n=>(_(),N(F,{key:n.id,label:n.tmName,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(h,{label:"SPU描述"},{default:t(()=>[e(y,{type:"textarea",placeholder:"请你输入SPU描述",modelValue:u(f).description,"onUpdate:modelValue":a[2]||(a[2]=n=>u(f).description=n)},null,8,["modelValue"])]),_:1}),e(h,{label:"SPU图片"},{default:t(()=>[e(ae,{"file-list":u(b),"onUpdate:fileList":a[3]||(a[3]=n=>G(b)?b.value=n:b=n),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":i,"on-remove":r,"before-upload":p},{default:t(()=>[e(te,null,{default:t(()=>[e(j)]),_:1})]),_:1},8,["file-list"]),e(ne,{modelValue:u(P),"onUpdate:modelValue":a[4]||(a[4]=n=>G(P)?P.value=n:P=n)},{default:t(()=>[O("img",{"w-full":"",src:u(D),alt:"Preview Image",style:{width:"100%",height:"100%"}},null,8,Ve)]),_:1},8,["modelValue"])]),_:1}),e(h,{label:"SPU销售属性"},{default:t(()=>[e(d,{modelValue:u(A),"onUpdate:modelValue":a[5]||(a[5]=n=>G(A)?A.value=n:A=n),placeholder:u(V).length?`还未选择${u(V).length}个`:"无"},{default:t(()=>[(_(!0),B(R,null,T(u(V),n=>(_(),N(F,{value:`${n.id}:${n.name}`,key:n.id,label:n.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"]),e(E,{onClick:c,disabled:!u(A),style:{"margin-left":"10px"},type:"primary",size:"default",icon:"Plus"},{default:t(()=>[M("添加属性")]),_:1},8,["disabled"]),e(oe,{border:"",style:{margin:"10px 0px"},data:u(s)},{default:t(()=>[e(J,{label:"序号",type:"index",align:"center",width:"80px"}),e(J,{label:"销售属性名字",width:"120px",prop:"saleAttrName"}),e(J,{label:"销售属性值"},{default:t(({row:n})=>[(_(!0),B(R,null,T(n.spuSaleAttrValueList,(H,re)=>(_(),N(ue,{style:{margin:"0px 5px"},onClose:we=>n.spuSaleAttrValueList.splice(re,1),key:H.id,class:"mx-1",closable:""},{default:t(()=>[M(ie(H.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),n.flag==!0?(_(),N(y,{key:0,onBlur:H=>q(n),modelValue:n.saleAttrValue,"onUpdate:modelValue":H=>n.saleAttrValue=H,placeholder:"请你输入属性值",size:"small",style:{width:"100px"}},null,8,["onBlur","modelValue","onUpdate:modelValue"])):(_(),N(E,{key:1,onClick:H=>S(n),type:"primary",size:"small",icon:"Plus"},null,8,["onClick"]))]),_:1}),e(J,{label:"操作",width:"120px"},{default:t(({$index:n})=>[e(E,{type:"primary",size:"small",icon:"Delete",onClick:H=>u(s).splice(n,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(h,null,{default:t(()=>[e(E,{disabled:!(u(s).length>0),type:"primary",size:"default",onClick:x},{default:t(()=>[M("保存")]),_:1},8,["disabled"]),e(E,{type:"primary",size:"default",onClick:w},{default:t(()=>[M("取消")]),_:1})]),_:1})]),_:1})}}}),Ae=["src"],Ie=X({__name:"SkuForm",emits:["changeScene"],setup(g,{expose:v,emit:k}){let I=m([]),w=m([]),z=m([]),b=m(),s=pe({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""});const K=async(U,i,r)=>{console.log(U,i,r),s.category3Id=r.category3Id,s.spuId=r.id,s.tmId=r.tmId;let p=await ce(U,i,r.category3Id);console.log(p.data);let V=await le(r.id),c=await ee(r.id);I.value=p.data,w.value=V.data,z.value=c.data},P=()=>{A("changeScene",0)},D=U=>{b.value.clearSelection(),b.value.toggleRowSelection(U,!0),s.skuDefaultImg=U.imgUrl};v({initSkuData:K});const f=async()=>{s.skuAttrValueList=I.value.reduce((i,r)=>{if(r.attrIdAndValueId){let[p,V]=r.attrIdAndValueId.split(":");i.push({attrId:p,valueId:V})}return i},[]),s.skuSaleAttrValueList=w.value.reduce((i,r)=>{if(r.saleIdAndValueId){let[p,V]=r.saleIdAndValueId.split(":");i.push({saleAttrId:p,saleAttrValueId:V})}return i},[]),(await ye(s)).code==200?(L({type:"success",message:"添加SKU成功"}),A("changeScene",0)):L({type:"error",message:"添加SKU失败"})};let A=k;return(U,i)=>{const r=o("el-input"),p=o("el-form-item"),V=o("el-option"),c=o("el-select"),S=o("el-form"),q=o("el-table-column"),x=o("el-button"),C=o("el-table");return _(),N(S,{"label-width":"100px"},{default:t(()=>[e(p,{label:"SKU名称"},{default:t(()=>[e(r,{placeholder:"SKU名称",modelValue:u(s).skuName,"onUpdate:modelValue":i[0]||(i[0]=l=>u(s).skuName=l)},null,8,["modelValue"])]),_:1}),e(p,{label:"价格(元)"},{default:t(()=>[e(r,{placeholder:"价格(元)",type:"number",modelValue:u(s).price,"onUpdate:modelValue":i[1]||(i[1]=l=>u(s).price=l)},null,8,["modelValue"])]),_:1}),e(p,{label:"重量(g)"},{default:t(()=>[e(r,{placeholder:"重量(g)",type:"number",modelValue:u(s).weight,"onUpdate:modelValue":i[2]||(i[2]=l=>u(s).weight=l)},null,8,["modelValue"])]),_:1}),e(p,{label:"SKU描述"},{default:t(()=>[e(r,{placeholder:"SKU描述",type:"textarea",modelValue:u(s).skuDesc,"onUpdate:modelValue":i[3]||(i[3]=l=>u(s).skuDesc=l)},null,8,["modelValue"])]),_:1}),e(p,{label:"平台属性"},{default:t(()=>[e(S,{inline:!0},{default:t(()=>[(_(!0),B(R,null,T(u(I),l=>(_(),N(p,{key:l.id,label:l.attrName},{default:t(()=>[e(c,{modelValue:l.attrIdAndValueId,"onUpdate:modelValue":a=>l.attrIdAndValueId=a,style:{width:"180px"}},{default:t(()=>[(_(!0),B(R,null,T(l.attrValueList,a=>(_(),N(V,{value:`${l.id}:${a.id}`,key:a.id,label:a.valueName},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(p,{label:"销售属性"},{default:t(()=>[e(S,{inline:!0},{default:t(()=>[(_(!0),B(R,null,T(u(w),l=>(_(),N(p,{label:l.saleAttrName,key:l.id},{default:t(()=>[e(c,{modelValue:l.saleIdAndValueId,"onUpdate:modelValue":a=>l.saleIdAndValueId=a,style:{width:"180px"}},{default:t(()=>[(_(!0),B(R,null,T(l.spuSaleAttrValueList,a=>(_(),N(V,{value:`${l.id}:${a.id}`,key:a.id,label:a.saleAttrValueName},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(p,{label:"图片名称"},{default:t(()=>[e(C,{border:"",data:u(z),ref_key:"table",ref:b},{default:t(()=>[e(q,{type:"selection",width:"80px",align:"center"}),e(q,{label:"图片"},{default:t(({row:l})=>[O("img",{src:l.imgUrl,alt:"",style:{width:"100px",height:"100px"}},null,8,Ae)]),_:1}),e(q,{label:"名称",prop:"imgName"}),e(q,{label:"操作"},{default:t(({row:l})=>[e(x,{type:"primary",size:"small",onClick:a=>D(l)},{default:t(()=>[M("设置默认")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(p,null,{default:t(()=>[e(x,{type:"primary",size:"default",onClick:f},{default:t(()=>[M("保存")]),_:1}),e(x,{type:"primary",size:"default",onClick:P},{default:t(()=>[M("取消")]),_:1})]),_:1})]),_:1})}}}),Ue={class:""},he=["src"],Ce=X({name:"SpuManage",__name:"SpuManage",setup(g){const v=me(),k=m(0);let I=m(1),w=m(3);const z=m([]),b=m(0),s=m(),K=m(),P=m([]);_e(()=>v.c3Id,()=>{v.c3Id&&D()});const D=async()=>{const c=await fe(I.value,w.value,v.c3Id);c.code===200&&(z.value=c.data.records,b.value=c.data.total)},f=()=>{k.value=1,s.value.initAddSpu(v.c3Id)},A=c=>{k.value=1,s.value.initHasSpuData(c)},U=c=>{k.value=c},i=c=>{k.value=2,K.value.initSkuData(v.c1Id,v.c2Id,c),D()},r=m(!1),p=async c=>{const S=await ve(c.id);console.log(S),S.code===200&&(P.value=S.data,r.value=!0)},V=async c=>{(await be(c.id)).code==200?(L({type:"success",message:"删除成功"}),D()):L({type:"error",message:"删除失败"})};return ge(()=>{v.$reset()}),(c,S)=>{const q=o("Category"),x=o("el-button"),C=o("el-table-column"),l=o("el-popconfirm"),a=o("el-table"),y=o("el-pagination"),h=o("el-dialog"),F=o("el-card");return _(),B("div",Ue,[e(q),e(F,{style:{margin:"10px 0"}},{default:t(()=>[Q(O("div",null,[e(x,{type:"primary",size:"default",onClick:f,icon:"Plus",disabled:!u(v).c3Id},{default:t(()=>[M("添加SPU")]),_:1},8,["disabled"]),e(a,{style:{margin:"10px 0"},border:"",data:z.value},{default:t(()=>[e(C,{label:"序号",type:"index",align:"center",width:"80px"}),e(C,{label:"SPU名称",prop:"spuName"}),e(C,{label:"SPU描述",prop:"description"}),e(C,{label:"SPU操作"},{default:t(d=>[e(x,{type:"primary",size:"small",icon:"Plus",title:"添加SKU",onClick:j=>i(d.row)},null,8,["onClick"]),e(x,{type:"warning",size:"small",icon:"Edit",title:"修改SPU",onClick:j=>A(d.row)},null,8,["onClick"]),e(x,{type:"info",size:"small",icon:"View",title:"查看SKU列表",onClick:j=>p(d.row)},null,8,["onClick"]),e(l,{title:`你确定删除${d.row.spuName}?`,width:"200px",onConfirm:j=>V(d.row)},{reference:t(()=>[e(x,{type:"primary",size:"small",icon:"Delete",title:"删除SPU"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(y,{"current-page":u(I),"onUpdate:currentPage":S[0]||(S[0]=d=>G(I)?I.value=d:I=d),"page-size":u(w),"onUpdate:pageSize":S[1]||(S[1]=d=>G(w)?w.value=d:w=d),"page-sizes":[3,5,9],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:b.value,onChange:D},null,8,["current-page","page-size","total"])],512),[[W,k.value==0]]),Q(e(ke,{ref_key:"spu",ref:s,onChangeScene:U},null,512),[[W,k.value==1]]),Q(e(Ie,{ref_key:"sku",ref:K,onChangeScene:U},null,512),[[W,k.value==2]]),e(h,{modelValue:r.value,"onUpdate:modelValue":S[2]||(S[2]=d=>r.value=d),title:"SKU列表"},{default:t(()=>[e(a,{border:"",data:P.value},{default:t(()=>[e(C,{label:"SKU名字",prop:"skuName"}),e(C,{label:"SKU价格",prop:"price"}),e(C,{label:"SKU重量",prop:"weight"}),e(C,{label:"SKU图片"},{default:t(({row:d})=>[O("img",{src:d.skuDefaultImg,style:{width:"100px",height:"100px"}},null,8,he)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})])}}});export{Ce as default};
