import{d as F,M as J,r as y,A as T,N as K,g as u,o as f,c as x,b as e,w as l,t as C,m as L,h as Q,j as m,F as G,s as H,n as h,v as w,x as A,B as z,O as R,K as p,P as W,Q as X}from"./index-r54z97pg.js";const Y=["onDblclick"],te=F({name:"AttrManage",__name:"AttrManage",setup(Z){const d=J(),v=y([]),i=y(0),a=y({attrName:"",attrValueList:[],categoryId:"",categoryLevel:3}),g=y([]);T(()=>d.c3Id,()=>{v.value=[],d.c3Id&&b()});const b=async()=>{const{c1Id:n,c2Id:s,c3Id:_}=d,r=await X(n,s,_);r.code===200&&(v.value=r.data,console.log(v.value))},I=()=>{a.value={attrName:"",attrValueList:[],categoryId:d.c3Id,categoryLevel:3},i.value=1},B=n=>{i.value=1,console.log(n),Object.assign(a.value,JSON.parse(JSON.stringify(n)))},V=()=>{i.value=0},D=()=>{a.value.attrValueList.push({valueName:"",flag:!0}),z(()=>{g.value[a.value.attrValueList.length-1].focus()})},$=async()=>{console.log(a.value),(await R(a.value)).code===200?(p.success(a.value.id?"修改成功":"保存成功"),i.value=0,b()):p.error(a.value.id?"修改失败":"保存失败")},S=(n,s)=>{if(n.valueName.trim()===""){a.value.attrValueList.splice(s,1),p.error("属性值不能为空");return}if(a.value.attrValueList.find(r=>{if(r!=n)return r.valueName===n.valueName})){p.error("属性值不能重复"),a.value.attrValueList.splice(s,1);return}n.flag=!1},O=(n,s)=>{n.flag=!0,z(()=>{g.value[s].focus()})},U=async n=>{(await W(n)).code===200?(p.success("删除成功"),b()):p.error("删除失败")};return K(()=>{d.$reset()}),(n,s)=>{const _=u("Category"),r=u("el-button"),c=u("el-table-column"),E=u("el-tag"),M=u("el-popconfirm"),N=u("el-table"),k=u("el-input"),P=u("el-form-item"),q=u("el-form"),j=u("el-card");return f(),x("div",null,[e(_,{scene:i.value},null,8,["scene"]),e(j,{style:{margin:"10px 0px"}},{default:l(()=>[C(L("div",null,[e(r,{onClick:I,type:"primary",size:"default",icon:"Plus",disabled:!Q(d).c3Id},{default:l(()=>[m("添加属性")]),_:1},8,["disabled"]),e(N,{border:"",style:{margin:"10px 0px"},data:v.value},{default:l(()=>[e(c,{label:"序号",type:"index",align:"center",width:"80px"}),e(c,{label:"属性名称",width:"120px",prop:"attrName"}),e(c,{label:"属性值名称"},{default:l(t=>[(f(!0),x(G,null,H(t.row.attrValueList,o=>(f(),h(E,{style:{margin:"5px"},key:o.id},{default:l(()=>[m(w(o.valueName),1)]),_:2},1024))),128))]),_:1}),e(c,{label:"操作",width:"120px"},{default:l(({row:t})=>[e(r,{type:"primary",size:"small",icon:"Edit",onClick:o=>B(t)},null,8,["onClick"]),e(M,{title:`你确定删除${t.attrName}?`,width:"200px",onConfirm:o=>U(t.id)},{reference:l(()=>[e(r,{type:"primary",size:"small",icon:"Delete"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])],512),[[A,i.value==0]]),C(L("div",null,[e(q,{inline:!0},{default:l(()=>[e(P,{label:"属性名称"},{default:l(()=>[e(k,{placeholder:"请你输入属性名称",modelValue:a.value.attrName,"onUpdate:modelValue":s[0]||(s[0]=t=>a.value.attrName=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{onClick:D,disabled:!a.value.attrName,type:"primary",size:"default",icon:"Plus"},{default:l(()=>[m("添加属性值")]),_:1},8,["disabled"]),e(r,{type:"primary",size:"default",onClick:V},{default:l(()=>[m("取消")]),_:1}),e(N,{border:"",style:{margin:"10px 0px"},data:a.value.attrValueList},{default:l(()=>[e(c,{label:"序号",width:"80px",type:"index",align:"center"}),e(c,{label:"属性值名称"},{default:l(t=>[t.row.flag?(f(),h(k,{key:0,ref:o=>g.value[t.index]=o,onBlur:o=>S(t.row,t.index),placeholder:"请你输入属性值名称",modelValue:t.row.valueName,"onUpdate:modelValue":o=>t.row.valueName=o,size:"small"},null,8,["onBlur","modelValue","onUpdate:modelValue"])):(f(),x("div",{key:1,onDblclick:o=>O(t.row,t.index)},w(t.row.valueName),41,Y))]),_:1}),e(c,{label:"属性值操作"},{default:l(({$index:t})=>[e(r,{type:"primary",size:"small",icon:"Delete",onClick:o=>a.value.attrValueList.splice(t,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),e(r,{type:"primary",size:"default",onClick:$,disabled:!(a.value.attrValueList.length>0)},{default:l(()=>[m("保存")]),_:1},8,["disabled"]),e(r,{type:"primary",size:"default",onClick:V},{default:l(()=>[m("取消")]),_:1})],512),[[A,i.value==1]])]),_:1})])}}});export{te as default};
