import{I as h,d as ee,r as p,a as le,D as ae,g as d,o as te,c as oe,b as l,w as a,h as s,J as v,j as f,m as $,F as re,B as P,K as R,p as ne,k as se,_ as ie}from"./index-r54z97pg.js";import{u as de}from"./setting-CBvWOeVN.js";const ue=(o,y,u)=>h.get(`/admin/acl/role/${o}/${y}/?roleName=${u}`),ce=o=>o.id?h.put("/admin/acl/role/update",o):h.post("/admin/acl/role/save",o),pe=o=>h.get("/admin/acl/permission/toAssign/"+o),me=(o,y)=>h.post(`/admin/acl/permission/doAssign/?roleId=${o}&permissionId=${y}`),fe=o=>h.delete("/admin/acl/role/remove/"+o),_e=o=>(ne("data-v-1c3997ea"),o=o(),se(),o),ge=_e(()=>$("h4",null,"分配菜单与按钮的权限",-1)),ve={style:{flex:"auto"}},ye=ee({name:"RoleManage",__name:"RoleManage",setup(o){let y=de(),u=p(1),w=p(10),g=p(""),x=p([]),S=p(0),m=p(!1),V=p(),_=p(!1),i=le({roleName:""}),I=p([]),N=p([]),z=p();ae(()=>{k()});const k=async(r=1)=>{u.value=r;let e=await ue(u.value,w.value,g.value);e.code==200&&(S.value=e.data.total,x.value=e.data.records)},j=()=>{k()},E=()=>{k(),g.value=""},O=()=>{y.refresh=!y.refresh},T=()=>{m.value=!0,Object.assign(i,{roleName:"",id:0}),P(()=>{V.value.clearValidate("roleName")})},B=r=>{m.value=!0,Object.assign(i,r),P(()=>{V.value.clearValidate("roleName")})},D={roleName:[{required:!0,trigger:"blur",validator:(r,e,n)=>{console.log(r),e.trim().length>=2?n():n(new Error("职位名称至少两位"))}}]},K=async()=>{await V.value.validate(),(await ce(i)).code==200&&(R({type:"success",message:i.id?"更新成功":"添加成功"}),m.value=!1,k(i.id?u.value:1))},L=async r=>{_.value=!0,Object.assign(i,r);let e=await pe(i.id);e.code==200&&(N.value=e.data,I.value=U(N.value,[]))},F={children:"children",label:"name"},U=(r,e)=>(r.forEach(n=>{n.select&&n.level==4&&e.push(n.id),n.children&&n.children.length>0&&U(n.children,e)}),e),H=async()=>{const r=i.id;let e=z.value.getCheckedKeys(),n=z.value.getHalfCheckedKeys(),C=e.concat(n);(await me(r,C)).code==200&&(_.value=!1,R({type:"success",message:"分配权限成功"}),window.location.reload())},J=async r=>{(await fe(r)).code==200&&(R({type:"success",message:"删除成功"}),k(x.value.length>1?u.value:u.value-1))};return(r,e)=>{const n=d("el-input"),C=d("el-form-item"),c=d("el-button"),q=d("el-form"),A=d("el-card"),b=d("el-table-column"),G=d("el-popconfirm"),Q=d("el-table"),W=d("el-pagination"),X=d("el-dialog"),Y=d("el-tree"),Z=d("el-drawer");return te(),oe(re,null,[l(A,null,{default:a(()=>[l(q,{inline:!0,class:"form"},{default:a(()=>[l(C,{label:"职位搜索"},{default:a(()=>[l(n,{placeholder:"请你输入搜索职位关键字",modelValue:s(g),"onUpdate:modelValue":e[0]||(e[0]=t=>v(g)?g.value=t:g=t)},null,8,["modelValue"])]),_:1}),l(C,null,{default:a(()=>[l(c,{type:"primary",size:"default",disabled:!s(g),onClick:E},{default:a(()=>[f("搜索")]),_:1},8,["disabled"]),l(c,{type:"primary",size:"default",onClick:O},{default:a(()=>[f("重置")]),_:1})]),_:1})]),_:1})]),_:1}),l(A,{style:{margin:"10px 0px"}},{default:a(()=>[l(c,{type:"primary",size:"default",icon:"Plus",onClick:T},{default:a(()=>[f("添加职位")]),_:1}),l(Q,{border:"",style:{margin:"10px 0px"},data:s(x)},{default:a(()=>[l(b,{type:"index",align:"center",label:"#"}),l(b,{label:"ID",align:"center",prop:"id"}),l(b,{label:"职位名称",align:"center",prop:"roleName","show-overflow-tooltip":""}),l(b,{label:"创建世间",align:"center","show-overflow-tooltip":"",prop:"createTime"}),l(b,{label:"更新时间",align:"center","show-overflow-tooltip":"",prop:"updateTime"}),l(b,{label:"操作",width:"280px",align:"center"},{default:a(({row:t})=>[l(c,{type:"primary",size:"small",icon:"User",onClick:M=>L(t)},{default:a(()=>[f("分配权限")]),_:2},1032,["onClick"]),l(c,{type:"primary",size:"small",icon:"Edit",onClick:M=>B(t)},{default:a(()=>[f("编辑")]),_:2},1032,["onClick"]),l(G,{title:`你确定要删除${t.roleName}?`,width:"260px",onConfirm:M=>J(t.id)},{reference:a(()=>[l(c,{type:"primary",size:"small",icon:"Delete"},{default:a(()=>[f("删除")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(W,{"current-page":s(u),"onUpdate:currentPage":e[1]||(e[1]=t=>v(u)?u.value=t:u=t),"page-size":s(w),"onUpdate:pageSize":e[2]||(e[2]=t=>v(w)?w.value=t:w=t),"page-sizes":[10,20,30,40],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:s(S),onCurrentChange:k,onSizeChange:j},null,8,["current-page","page-size","total"])]),_:1}),l(X,{modelValue:s(m),"onUpdate:modelValue":e[5]||(e[5]=t=>v(m)?m.value=t:m=t),title:s(i).id?"更新职位":"添加职位"},{footer:a(()=>[l(c,{type:"primary",size:"default",onClick:e[4]||(e[4]=t=>v(m)?m.value=!1:m=!1)},{default:a(()=>[f("取消")]),_:1}),l(c,{type:"primary",size:"default",onClick:K},{default:a(()=>[f("确定")]),_:1})]),default:a(()=>[l(q,{model:s(i),rules:D,ref_key:"form",ref:V},{default:a(()=>[l(C,{label:"职位名称",prop:"roleName"},{default:a(()=>[l(n,{placeholder:"请你输入职位名称",modelValue:s(i).roleName,"onUpdate:modelValue":e[3]||(e[3]=t=>s(i).roleName=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(Z,{modelValue:s(_),"onUpdate:modelValue":e[7]||(e[7]=t=>v(_)?_.value=t:_=t)},{header:a(()=>[ge]),default:a(()=>[l(Y,{ref_key:"tree",ref:z,data:s(N),"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":s(I),props:F},null,8,["data","default-checked-keys"])]),footer:a(()=>[$("div",ve,[l(c,{onClick:e[6]||(e[6]=t=>v(_)?_.value=!1:_=!1)},{default:a(()=>[f("取消")]),_:1}),l(c,{type:"primary",onClick:H},{default:a(()=>[f("确定")]),_:1})])]),_:1},8,["modelValue"])],64)}}}),we=ie(ye,[["__scopeId","data-v-1c3997ea"]]);export{we as default};
